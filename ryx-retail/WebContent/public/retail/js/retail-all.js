var HOME={};HOME.Const={WINDOW_RESIZE:"window_resize",SHOW_LOADING:"show_loading",HIDE_LOADING:"hide_loading",SHOW_MASK:"show_mask",HIDE_MASK:"hide_mask",SHOW_ALERT:"show_alert",SHOW_DIALOG:"show_dialog",SHOW_LAYER:"show_layer",SHOW_CONFIRM:"show_confirm",CLOSE_DIALOG:"close_dialog",CLOSE_LAYER:"close_layer",LOAD_TEMPLATE:"load_html",LOAD_JSPLUGINS:"load_js",SHOW_MODULE:"show_module",CLOSE_MODULE:"close_module",REQUEST_ERROR:"request_error",DATA_ERROR:"data_error",BAR_CODE:"bar_code",INIT_COMPLETE:"init_complete",TOBACCO_COMPLETE:"tobacco_complete"};HOME.Keys={BACK:8,TAB:9,ENTER:13,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,MULTIPLY:106,ADD:107,SUBTRACT:109,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DEL:127,BARCODE:999};HOME.Sandbox=function($){var result=function(coreObj,moduleId,context){this.coreObj=coreObj;this.moduleId=moduleId;this.context=context;if(typeof console=="undefined"){this.console={log:function(){},error:function(){},wran:function(){},info:function(){}}}else{this.console=console}this.user=this.context.user};result.fn=result.prototype;result.fn.register=function(name,value){result.fn[name]=value};result.fn.listen=function(eventNames,callback,module){this.coreObj.listen(this.moduleId,eventNames,callback,module);return this};result.fn.notify=function(event){return this.coreObj.broadcast(event)};result.fn.request=function(url,type,dataType,data,success,error,showLoading){var obj=url;if(typeof(obj)=="string"){obj={url:url,type:type,dataType:dataType,data:data,success:success,error:error,showLoading:showLoading}}if(!obj.type){obj.type="post"}if(!obj.dataType){obj.dataType="json"}if(obj.dataType=="jsonp"){obj.jsonp="jsonp"}if(obj.data){obj.data.requestType="ajax"}else{obj.data={requestType:"ajax"}}if(obj.expires){var now=new Date();switch(obj.expires){case"h":obj.data.t=now.format("yyyyMMddhh");break;case"d":obj.data.t=now.format("yyyyMMdd");break;case"m":obj.data.t=now.format("yyyyMM");break}}if(typeof obj.showLoading=="undefined"){obj.showLoading=true}if(!obj.timeout){obj.timeout=60000}var scb=obj.success;var ecb=obj.error;var $this=this;var timeout=-1;obj.success=function(data){clearTimeout(timeout);$this.hideLoading();if(obj.dataType=="json"||obj.dataType=="jsonp"){if(data&&data.code=="0000"){if(scb){scb(data)}}else{var b=true;if(ecb){b=ecb(data)}if(b!==false){$this.notify({type:HOME.Const.DATA_ERROR,data:data})}}}else{if(scb){scb(data)}}};obj.error=function(){clearTimeout(timeout);$this.hideLoading();$this.notify({type:HOME.Const.REQUEST_ERROR,data:arguments});if(ecb){ecb(arguments)}};if(obj.showLoading){timeout=setTimeout(function(){$this.showLoading()},100)}$.ajax(obj);return this};result.fn.showLoading=function(){this.notify({type:HOME.Const.SHOW_LOADING,data:""});return this};result.fn.hideLoading=function(){this.notify({type:HOME.Const.HIDE_LOADING,data:""});return this};result.fn.showMask=function(data){this.notify({type:HOME.Const.SHOW_MASK,data:data});return this};result.fn.hideMask=function(){this.notify({type:HOME.Const.HIDE_MASK,data:""});return this};result.fn.showLayer=function(data){var id=null;if(data.content&&data.content.jquery){id=data.content.attr("id")}this.notify({type:HOME.Const.SHOW_LAYER,data:data});if(id){return $("#"+id)}};result.fn.closeLayer=function(data){this.notify({type:HOME.Const.CLOSE_LAYER,data:data})};result.fn.showDialog=function(data){var id=null;if(data.content&&data.content.jquery){id=data.content.attr("id")}this.notify({type:HOME.Const.SHOW_DIALOG,data:data});if(id){return $("#"+id)}};result.fn.closeDialog=function(data){this.notify({type:HOME.Const.CLOSE_DIALOG,data:data})};result.fn.createDialog=function(data){};result.fn.showAlert=function(data){this.notify({type:HOME.Const.SHOW_ALERT,data:data})};result.fn.showConfirm=function(data){this.notify({type:HOME.Const.SHOW_CONFIRM,data:data})};result.fn.getContextPath=function(){return this.context.root};result.fn.getContextFullPath=function(){return this.context.domain};result.fn.getResourcePath=function(){return this.context.resource};result.fn.getMasterPath=function(){return this.context.master};result.fn.getTobaccoImage=function(bar,size,position){if(!size){size="m"}if(!position){position="face"}return this.getResourcePath()+"images/tobacco/"+size+"/"+bar+"_"+size+"_"+position+".png"};result.fn.getItemImage=function(bar,size,position){if(!size){size="m"}if(!position){position="face"}return this.getResourcePath()+"images/item/"+size+"/"+bar+"_"+size+"_"+position+".png"};result.fn.getBankImage=function(id,size,position){if(!size){size="s"}if(!position){position="face"}if(!(id.indexOf("0313")==0)){id=id.substr(0,4)}return this.getResourcePath()+"images/bank/"+size+"/"+id+"_"+size+"_"+position+".png"};result.fn.stopEvent=function(e){var evt=e||window.event;evt.stopPropagation?evt.stopPropagation():(evt.cancelBubble=true)};result.fn.getHashcode=function(){return location.hash};result.fn.setHashcode=function(hash){location.hash=hash};result.fn.getDatas=function(key){return this.coreObj.getDatas(key)};result.fn.setDatas=function(key,value){this.coreObj.setDatas(key,value)};result.fn.isTobacco=function(type){if(type){return type.indexOf("01")==0}else{return false}};result.fn.loadTemplate=function(url,callback){this.notify({type:HOME.Const.LOAD_TEMPLATE,data:{url:url,callback:callback}})};result.fn.getVersion=function(){return this.context.version};return result}(jQuery);HOME.Core=function($,library){var modules={};var listens={};var context={};var isStart=false;var box=null;function triggerEvent(obj){var type=obj.type;var data=obj.data;var lisarr=listens[type];b=true;if(lisarr){for(var i=0,j=lisarr.length;i<j;i++){if(lisarr[i]&&lisarr[i]["method"]){var ret=lisarr[i]["method"](data,type);if(ret===false){b=false;break}}}}return b}var ret={startApp:function(){},register:function(name,module){modules[name]={createor:module,instance:null};if(isStart){this.start(name)}},start:function(name){modules[name].instance=modules[name].createor(new HOME.Sandbox(this,name,context));modules[name].instance.init()},stop:function(name){var module=modules[name];if(module.instance){module.instance.destroy();module.instance=null}},startAll:function(c){if(c){$.extend(context,c)}for(var m in modules){if(modules.hasOwnProperty(m)){this.start(m)}}isStart=true},stopAll:function(){for(var m in modules){if(modules.hasOwnProperty(m)){this.stop(m)}}isStart=false},listen:function(moduleId,eventNames,callback,module){if(!$.isArray(eventNames)){eventNames=[eventNames]}$.each(eventNames,function(i,name){if(listens[name]){listens[name].push({moduleId:moduleId,method:callback,scope:module})}else{listens[name]=[{moduleId:moduleId,method:callback,scope:module}]}})},broadcast:function(event){return triggerEvent(event)}};box=new HOME.Sandbox(ret,"core",context);return ret}(jQuery);HOME.Core.register("plugin-dialog",function(box){var alertView=$("#alertView");var alertFlag=0;var confirmView=$("#confirmView");var $window=$(window);var dialogs=new Array();function showDialog(data){var w=parseFloat(data.width);w=Math.min(960,Math.max(300,w));var h=parseFloat(data.height);h=Math.min(600,Math.max(240,h));var def={width:w,height:h,modal:true,closeOnEscape:false,resizable:false,minWidth:300,minHeight:240,maxWidth:960,maxHeight:600,closeText:"关闭(Esc)",dialogClass:"dialog_middle"};$.extend(def,data);def.open=function(){if(box.keys.array[box.keys.array.length-1]!="dialog_onkey"){box.keys.push("dialog_onkey")}dialogs.push(data);if(data.open){data.open(arguments)}};def.beforeClose=function(){if(!data.forceClose){var b=true;if(data.beforeClose){b=data.beforeClose({callback:function(){data.forceClose=true;closeDialog(data)}})}return b}};def.close=function(e){for(var i=0;i<dialogs.length;i++){if(dialogs[i]==data){dialogs.splice(i,1);break}}if(dialogs.length==0){box.keys.pop("dialog_onkey")}if(data.close){data.close(arguments)}data.content.remove()};data.content.dialog(def)}function closeDialog(data){if(data.content){try{data.content.dialog("close")}catch(e){box.console.log("close窗口出现异常："+e.message);var closest=data.content.closest("ui-dialog");if(closest.length>0){closest.prev("ui-widget-overlay").remove();closest.remove()}}}}function showLayer(data){var w=$window.width()-80;var h=$window.height()-80;h=Math.min(720,Math.max(600,h));var def={width:w,height:h,modal:true,closeOnEscape:false,minWidth:960,minHeight:600,maxWidth:1200,maxHeight:720,closeText:"关闭(Esc)",dialogClass:"dialog_layer"};$.extend(def,data);def.open=function(){if(data.open){data.open(arguments)}};def.close=function(){data.content.remove();if(data.close){data.close(arguments)}};data.content.dialog(def);box.notify({type:"pauseRoll",data:null})}function closeLayer(data){if(data.content){try{data.content.dialog("close")}catch(e){box.console.log("关闭窗口出现异常："+e.message);var closest=data.content.closest("ui-dialog");if(closest.length>0){closest.prev("ui-widget-overlay").remove();closest.remove()}}}box.notify({type:"restartRoll",data:null})}function showAlert(data){if(!data||!data.message){return}var label=alertView.find("#alertViewText");label.html(data.message);if(!data.time){data.time=4000}if(alertFlag){clearTimeout(alertFlag)}alertView.stop();var y=$window.height()*0.85;var x=($window.width()-alertView.width()-20)/2;alertView.css({top:y,left:x}).hide();alertView.animate({top:y-50,opacity:"show"},500);alertFlag=setTimeout(function(){alertView.animate({top:y-100,opacity:"hide"},500)},data.time)}function showConfirm(data){var label=confirmView.find("#confimViewText");label.html(data.message);data.content=confirmView;var def={width:360,modal:true,closeOnEscape:false,resizable:false,title:"提示",closeText:"关闭(Esc)",dialogClass:"dialog_middle"};$.extend(def,data);confirmView.find("#confirmViewExtend").empty();if(def.extendView){confirmView.find("#confirmViewExtend").append(def.extendView)}var isCancel=true;var onOk=function(){isCancel=false;confirmView.dialog("close");if(data.ok){data.ok(confirmView)}};var onCancel=function(){confirmView.dialog("close")};var onSubmit=function(){isCancel=false;confirmView.dialog("close");if(data.submit){data.submit()}};var onDonotSubmit=function(){isCancel=false;confirmView.dialog("close");if(data.donotSubmit){data.donotSubmit()}};if(def.hasSubmit){if(!def.buttons){if(!def.buttonText){def.buttons=[{text:"保 存","class":"primary_button",click:onSubmit},{text:"不保存","class":"closebtn_button",click:onDonotSubmit},{text:"取 消","class":"closebtn_button",click:onCancel}]}else{def.buttons=[{text:def.buttonText[0],"class":"primary_button",click:onSubmit},{text:def.buttonText[1],"class":"closebtn_button",click:onDonotSubmit},{text:def.buttonText[2],"class":"closebtn_button",click:onCancel}]}}}else{if(!def.buttons){def.buttons=[{text:"确 定","class":"primary_button",click:onOk},{text:"取 消","class":"closebtn_button",click:onCancel}]}}def.open=function(){if(box.keys.array[box.keys.array.length-1]!="dialog_onkey"){box.keys.push("dialog_onkey")}dialogs.push(data)};def.close=function(){for(var i=0;i<dialogs.length;i++){if(dialogs[i]==data){dialogs.splice(i,1);break}}if(dialogs.length==0){box.keys.pop("dialog_onkey")}data.content.remove();if(isCancel&&data.cancel){data.cancel(confirmView)}};confirmView.dialog(def);setTimeout(function(){confirmView.focus()},100)}function onKey(data){if(!dialogs.length){return}var dial=dialogs[dialogs.length-1];var widgets=null;if(dial&&dial.content){widgets=dial.content.find("[data-onkey=true]")}switch(data.key){case HOME.Keys.ESC:closeDialog(dial);break;default:var b=false;if(widgets&&widgets.length){if(typeof box.keys.widgetOnkey!="undefined"){b=box.keys.widgetOnkey(widgets,data)}}if(!b&&dial.onkey){dial.onkey(data)}break}}return{init:function(){box.listen(HOME.Const.SHOW_ALERT,showAlert);box.listen(HOME.Const.SHOW_DIALOG,showDialog);box.listen(HOME.Const.SHOW_LAYER,showLayer);box.listen(HOME.Const.SHOW_CONFIRM,showConfirm);box.listen(HOME.Const.CLOSE_DIALOG,closeDialog);box.listen(HOME.Const.CLOSE_LAYER,closeLayer);box.listen("dialog_onkey",onKey)},destroy:function(){}}});HOME.Core.register("plugin-loading",function(box){var loading=$("#loadingView");var mask=$("#maskView");function load(){}function showLoading(){loading.show()}function hideLoading(){loading.hide()}function showMask(data){mask.find("#mask_message").text(data.message);mask.find("#message_detail").html(data.detailMSG);mask.find("#mask_hidden").hide();mask.find("#feeContent").hide();if(data.hiddenButton&&!data.hiddenButton.hidden){mask.find("#mask_hidden").val(data.hiddenButton.val).unbind("click").click(function(){var callback=data.hiddenButton.callback;callback()}).show()}if(data.feeContent&&!data.feeContent.hidden){mask.find("#posFee").html(data.feeContent.val);mask.find("#feeContent").show()}if(data.cancelButton&&data.cancelButton.callback){mask.find("#mask_cancel").unbind("click").click(function(){var callback=data.cancelButton.callback;callback()})}else{mask.find("#mask_cancel").unbind("click").click(function(){mask.hide()})}mask.show()}function hideMask(){mask.hide()}return{init:function(){load();box.listen(HOME.Const.SHOW_LOADING,showLoading);box.listen(HOME.Const.HIDE_LOADING,hideLoading);box.listen(HOME.Const.SHOW_MASK,showMask);box.listen(HOME.Const.HIDE_MASK,hideMask)},destroy:function(){}}});HOME.Core.register("plugin-message",function(box){function requestError(args){var p0=args[0];var p2=args[1];if(p0){if(p0.status==200){box.showAlert({message:"请求服务器出错："+p2})}else{if(p0.status==0){box.showAlert({message:"请求服务器出错：网络错误"})}else{box.showAlert({message:"请求服务器出错："+p0.status})}}}else{box.showAlert({message:"请求服务器出错：无状态"})}}function dataError(data){if(!data){box.showAlert({message:"服务器返回的数据为空"})}else{if(data.code=="1000"){box.showAlert({message:data.msg})}else{if(data.code=="1001"){box.showAlert({message:"出现服务器端错误！"})}else{if(data.code=="1002"){box.showAlert({message:"无权限访问接口！"})}else{if(data.code=="1003"){box.showAlert({message:"您的身份已失效，将会转向到登录页面！"});setTimeout(function(){var u=box.user.login_url+"?serviceFlag="+box.user.service_flag+"&callbackURL="+box.user.callback_url+"&onceFlag=";window.location.href=u},1000)}else{if(data.code=="1004"){box.showAlert({message:"访问接口不存在！"})}else{if(data.code=="1005"){box.showAlert({message:"缺少必要的参数或参数格式不正确！"})}else{box.showAlert({message:"系统忙，请稍后再试！"})}}}}}}}}return{init:function(){box.listen(HOME.Const.REQUEST_ERROR,requestError);box.listen(HOME.Const.DATA_ERROR,dataError)},destroy:function(){}}});HOME.Core.register("plugin-loadtemplate",function(box){function trim(stuff){if("".trim){return stuff.trim()}else{return stuff.replace(/^\s+/,"").replace(/\s+$/,"")}}function renderData(html){if(html){if(!$.isPlaceholder()){var list=html.find("input[placeholder],textarea[placeholder]");if(html.is("input[placeholder],textarea[placeholder]")){list=html}$.each(list,function(i,obj){var $obj=$(obj);if(!$obj.val()){$obj.addClass("prompt_label");$obj.attr("value",$obj.attr("placeholder"))}})}var onError=function(e){var target=e.target;target.src=box.getContextPath()+"public/img/zwtp.png"};html.find("img").error(onError)}}var ich={templates:{},htmls:{},render:function(template,view,partials){return Mustache.render(template,view,partials)},$:(typeof window!=="undefined")?window.jQuery||window.Zepto||null:null,addTemplate:function(name,templateString){if(typeof name==="object"){for(var template in name){this.addTemplate(template,name[template])}return}if(ich[name]){box.console.error("Invalid name: "+name+".")}else{if(ich.templates[name]){box.console.error('Template "'+name+'  " exists')}else{ich.templates[name]=templateString;ich[name]=function(data,raw){data=data||{};var result=ich.render(ich.templates[name],data,ich.templates);var r=(ich.$&&!raw)?ich.$(trim(result)):result;if(r.jquery&&!r.attr("id")){r.attr("id",name)}renderData(r);return r}}}},clearAll:function(){for(var key in ich.templates){delete ich[key]}ich.templates={}},refresh:function(){ich.clearAll();ich.grabTemplates()},grabTemplates:function(doc){var i,l,scripts=doc.find("script"),script,trash=[];for(i=0,l=scripts.length;i<l;i++){script=scripts[i];if(script&&script.innerHTML&&script.id&&(script.type==="text/html"||script.type==="text/mustache")){ich.addTemplate(script.id,trim(script.innerHTML));trash.unshift(script)}}for(i=0,l=trash.length;i<l;i++){trash[i].parentNode.removeChild(trash[i])}}};function onLoadTemplate(data){if(box.ich.htmls[data.url]){if(data.success){data.success(box.ich.htmls[data.url])}}else{$.ajax({url:box.getContextPath()+data.url+"?t="+new Date().getTime(),data:data.data,dataType:"html",success:onLoadCallback(data),error:onLoadError(data)})}}function onLoadCallback(data){return function(html){var dom=document.createElement("div");dom.innerHTML=html;if(!dom.innerHTML){$html=$("<div>"+html+"</div>")}else{$html=$(dom)}box.ich.htmls[data.url]=$html;box.ich.grabTemplates($html);if(data.success){data.success($html)}}}function onLoadError(data){return function(){box.showAlert({message:"加载模版文件失败："+data.url+(arguments[1]?"，"+arguments[1]:"")})}}return{init:function(){box.register("ich",ich);box.listen(HOME.Const.LOAD_TEMPLATE,onLoadTemplate);box.ich.grabTemplates($)},destroy:function(){}}});HOME.Core.register("plugin-loadjs",function(box){var jss={};function onLoadJSPlugins(data){if(!jss[data.url]){$.ajax({url:box.getContextPath()+data.url+"?t="+new Date().getTime(),dataType:"script",success:onLoadCallback(data),error:onLoadError(data)})}else{if(data.success){data.success()}}}function onLoadCallback(data){return function(){jss[data.url]=true;if(data.success){data.success()}}}function onLoadError(data){return function(){box.showAlert({message:"加载操作文件失败："+data.url+(arguments[1]?"，"+arguments[1]:"")})}}return{init:function(){box.listen(HOME.Const.LOAD_JSPLUGINS,onLoadJSPlugins)},destroy:function(){}}});HOME.Core.register("plugin-components",function(box){var netcallJs="public/retail/js/plugins/public/netcall.js";var com={};var success=false;function initCom(){com.initParams=function(){};com.showScreen=function(){};com.print=function(){};com.formFeed=function(){};com.printQr=function(){};com.openCashBox=function(){};com.consume=function(obj,callback){};com.readCardPwd=function(){};com.openSJKD=function(){box.showAlert({message:"网页中无法启动手机看店程序，请安装客户端查看"})};com.commSend=function(obj){if(success){swfObj.send(obj)}};com.log=function(){};com.printTicket=function(){};com.getItem=function(){return null};com.getItemAsync=function(data,callback){if(callback){callback(null)}};com.onReceive=function(command,params){if(command=="barcode"){var act=$(document.activeElement);var respond=act.attr("data-respond");if(respond!="false"){if(params.length==13||params.length==12||params.length==8){setTimeout(function(){box.keys.onkey({key:HOME.Keys.BARCODE,code:params})},10)}else{box.showAlert({message:"读到的条码不正确，请重新扫码"})}}else{if($.isInput(act[0])){act.val(params);act.change()}}}else{if(command=="onbarinput"){if(params=="0"){setTimeout(function(){window.onBarInput=params},100)}else{window.onBarInput=params}}else{if(command=="onAward"){var obj=$.str2obj(params);if(obj.raffle_opt=="0"){box.showAlert({message:"顾客未中奖"})}else{box.showAlert({message:"顾客中了"+obj.opt_name+obj.item_name,time:6000})}}}}return command};window.onBarInput="0";window.onReceive=com.onReceive;box.register("com",com);loadNetcall()}function loadNetcall(){$.checkInShell(function(b){if(b){box.notify({type:HOME.Const.LOAD_JSPLUGINS,data:{url:netcallJs,success:loadNetJSSuccess}})}})}function loadNetJSSuccess(){box.console.log("通信JS加载成功")}return{init:function(){initCom()},destroy:function(){}}});HOME.Core.register("plugin-shortcuts",function(box){var keys={};keys.array=new Array();function load(){box.register("keys",keys);keys.onkey=function(data){if(keys.array.length>0){var l=keys.array[keys.array.length-1];box.notify({type:l,data:data})}};keys.push=function(tag){keys.array.push(tag)};keys.pop=function(str){if(keys.array.length>0){if(typeof str=="undefined"){keys.array.length=keys.array.length-1}else{if(keys.array[keys.array.length-1]==str){keys.array.length=keys.array.length-1}}}};keys.popToFirst=function(){if(keys.array.length>0){keys.array.length=1}}}return{init:function(){load()},destroy:function(){}}});HOME.Core.register("plugin-barcode",function(box){var win=$(document);var keysObj={};var barcode="";var time=-1;var start=0;var len=0;var hasprevent=false;var current=null;var verify=null;var empty=null;var prompt=null;var oldArr=[{t:0,str:"",ch:""},{t:0,str:"",ch:""}];var t=0;function listener(){win.keydown(onKeyDown);win.focusin(onFocusin);for(var i in HOME.Keys){keysObj["_"+HOME.Keys[i]]=true}}function onKeyDown(e){var eve=e;if(window.event){eve=window.event}var key=window.event?e.keyCode:e.which;var respond=$(e.target).attr("data-respond");if(window.onBarInput=="1"){if(respond!="false"){return false}}if(key==9||key==13){if(time>0){barInputEnd();return false}}if(key>=48&&key<=57){if(respond!="false"){var ch=String.fromCharCode(key);if(time>0){barcode+=ch;return false}else{var t2=new Date().getTime();var span=t2-t;t=t2;box.console.log(span);if(span<30){if(t2-oldArr[0].t<100){if($.isInput(e.target)){e.target.value=oldArr[0].str}barcode=oldArr[0].ch+oldArr[1].ch+ch}else{if($.isInput(e.target)){e.target.value=oldArr[1].str}barcode=oldArr[1].ch+ch}time=setTimeout(barInputEnd,200);return false}else{putOldKey(t,e.target.value,ch)}}}}if($.isInput(e.target)){if(key==8||key==9||key==13||key==32||key==35||key==36||key==37||key==39||key==127){var $inp=$("input:not(:disabled)");if(key==13){e.preventDefault();var nxtIdx=$inp.index(e.target)+1;$("input:not(:disabled):eq("+nxtIdx+")").focus().select();eve.keyCode=9;var enter=$(e.target).attr("data-enter");if(enter){$("#"+enter).click()}else{$(e.target).blur()}}return}}else{if($.isComponent(e.target)){if(key==9||key==13){return}}}var quickkey=$(e.target).attr("data-keys");if(quickkey){quickkey=","+quickkey+",";if(quickkey.indexOf(","+key+",")!=-1){return}}if(keysObj["_"+key]){box.keys.onkey({key:key});if(e&&e.stopPropagation){e.stopPropagation()}else{window.event.cancelBubble=true}var browser=navigator.appName;var b_version=navigator.appVersion;var version=b_version.split(";");var trim_Version=version[1].replace(/[ ]/g,"");if(browser=="Microsoft Internet Explorer"&&trim_Version=="MSIE7.0"){window.event.keyCode=0}return false}}function putOldKey(t,str,ch){var item=oldArr[0];item.t=t;item.str=str;item.ch=ch;oldArr[0]=oldArr[1];oldArr[1]=item}function barTimeout(){barcode="";len=0;clearTimeout(time);time=-1;oldArr=[{t:0,str:"",ch:""},{t:0,str:"",ch:""}];box.showAlert("读到的条码不正确，请重新扫码")}function barInputEnd(){var b=barcode;if(b){if(b.length==13||b.length==12||b.length==8){box.console.log(b);box.keys.onkey({key:HOME.Keys.BARCODE,code:b})}else{box.showAlert("读到的条码不正确，请重新扫码")}}barcode="";len=0;clearTimeout(time);time=-1;oldArr=[{t:0,str:"",ch:""},{t:0,str:"",ch:""}]}function onFocusin(e){releaseInput();if(!$.isComponent(e.target)){return}hasprevent=false;current=$(e.target);verify=current.attr("data-verify");empty=current.attr("data-empty");prompt=current.attr("placeholder");current.keypress(onFocusKeyDown);current.focusout(onFocusOut);if(prompt&&!$.isPlaceholder()){if(!current.val()||current.val()===prompt){current.val("")}current.removeClass("prompt_label")}if(current[0].nodeName=="INPUT"&&!current.attr("maxlength")){current.attr("maxlength",16)}}function onFocusKeyDown(e){var key=window.event?e.keyCode:e.which;var target=$(e.currentTarget);if(key<32){return}if(time>0){return}var val=target.val();var keychar=e["char"];if(!keychar){keychar=String.fromCharCode(key)}verify=target.attr("data-verify");var b=true;switch(verify){case"int":b=/[-\d]/.test(keychar);if(b){if(keychar=="-"&&!val){b=false}}break;case"pint":b=/\d/.test(keychar);break;case"number":b=/[-\.\d]/.test(keychar);if(b){if(keychar=="-"&&!val){b=false}else{if(keychar=="."&&val.indexOf(".")!=-1){b=false}}}break;case"pnumber":b=/[\.\d]/.test(keychar);if(b){if(keychar=="."&&val.indexOf(".")!=-1){b=false}}break;case"phone":b=/\d/.test(keychar);break;case"email":b=/[A-Za-z0-9\.@-_]/.test(keychar);if(b){if(keychar=="@"&&val.indexOf("@")!=-1){b=false}}break;case"time":b=/[:\d]/.test(keychar);break;case"date":b=/[-\d]/.test(keychar);break;case"card":b=/[Xx\d]/.test(keychar);break}return b}function onFocusOut(e){var target=$(e.currentTarget);var val=target.val();verify=target.attr("data-verify");empty=target.attr("data-empty");prompt=target.attr("placeholder");if(empty=="false"){if(!val){target.addClass("validate")}}if(val){var b=$.validate(val,verify);if(!b){target.addClass("validate")}else{target.removeClass("validate")}}else{if(prompt&&!$.isPlaceholder()){target.addClass("prompt_label");target.val(prompt)}}if(hasprevent){target.change()}}function releaseInput(){if(current){current.unbind("keypress",onFocusKeyDown);current.unbind("focusout",onFocusOut);current=null}}return{init:function(){listener()},destroy:function(){win.unbind("keydown",onKeyDown)}}});HOME.Core.register("plugin-winevent",function(box){var win=$(document);function listener(){win.click(onDocumentClick)}function onDocumentClick(e){var target=$(e.target);var dc=target.attr("data-doubleclick");if(dc==="false"){target.attr("disabled","disabled")}}return{init:function(){box.listen(HOME.Const.INIT_COMPLETE,listener)},destroy:function(){}}});HOME.Core.register("plugin-loadparams",function(box){var tobaccoParamsUrl="retail/tobacco/getOrderParams";var controlHtml="public/retail/js/plugins/public/controls.html";var controlJs="public/retail/js/plugins/public/controls.js";var merchParams="retail/getMerchParams";var labels={};var unitObject={array:[]};var kindObject={array:[],map:{}};var tobaccoObject={};var tobaccoStatus={"00":"未提交","01":"计划","02":"订购","03":"确认","0301":"预确认","04":"发货","08":"停止","09":"完成","05":"未知","06":"未知","07":"未知","10":"未知","99":"未知","11":"正在支付"};var tobaccoPayStatus={"01":"挂帐","02":"未付款","03":"收款","04":"划帐","05":"待划账"};var saleStatus={"00":"已废弃","01":"已下单","02":"已审核","03":"已完成","04":"已取消"};var orderType={"01":"电脑","02":"POS","03":"管店宝","04":"楼下店"};var promotionType={"10":"商品折扣","13":"会员折扣","20":"搭配促销","30":"商品积分","33":"销售单积分","40":"满减促销","50":"抽奖"};var orderPay={"01":"未收款","02":"挂账","03":"已收款"};function load(){labels.promotiontype=promotionType;labels.tobacco=tobaccoStatus;labels.tobaccopay=tobaccoPayStatus;labels.ordersale=saleStatus;labels.ordertype=orderType;labels.orderpay=orderPay;box.register("labels",labels);box.register("unit",unitObject);box.register("kinds",kindObject);box.register("tobacco",tobaccoObject);loadControls()}function loadControls(){box.notify({type:HOME.Const.LOAD_TEMPLATE,data:{url:controlHtml,success:loadTemplateSuccess}})}function loadTemplateSuccess(){box.notify({type:HOME.Const.LOAD_JSPLUGINS,data:{url:controlJs,success:loadJSSuccess}})}function loadJSSuccess(){loadParams()}function loadParams(){box.request({url:box.getContextPath()+merchParams,success:onGetParams})}function onGetParams(data){if(data&&data.code=="0000"){initUnits(data.result.units);initKinds(data.result.kinds)}box.notify({type:HOME.Const.INIT_COMPLETE});loadTobaccoParams()}function initUnits(unitInfo){unitObject.array=unitInfo;$.each(unitInfo,function(index,unit){unit.label=unit.unit_name;unit.search=unit.unit_code+" "+unit.unit_spell;unitObject[unit.unit_id]=unit.unit_name})}function initKinds(kindInfo){var kindarr=[];var kindmap={"":"全部商品",undefined:"全部商品"};$.each(kindInfo,function(index,kind){kindObject[kind.item_kind_id]=kind.item_kind_name;kindmap[kind.item_kind_name]=kind.item_kind_id;kindarr[index]={id:kind.item_kind_id,pId:kind.item_kind_parent,name:kind.item_kind_name,isParent:kind.item_kind_parent=="0",label:kind.item_kind_name,search:kind.item_kind_id+" "+kind.item_kind_short_name+" "+kind.item_kind_code}});kindObject.array=kindarr;kindObject.map=kindmap}function loadTobaccoParams(){box.request({url:box.getContextPath()+tobaccoParamsUrl,success:onGetTobaccoParams,error:onGetTobaccoParamsError})}function onGetTobaccoParams(data){if(data&&data.code=="0000"){tobaccoObject.params=data.result;box.notify({type:HOME.Const.TOBACCO_COMPLETE})}}function onGetTobaccoParamsError(data){return false}return{init:function(){load()},destroy:function(){}}});HOME.Core.register("plugin-msgPush",function(box){var socketJs="public/js/common/socket.io.js";var socket=null;var msgContent=null;function loadSocketJs(){box.notify({type:HOME.Const.LOAD_JSPLUGINS,data:{url:socketJs,success:socketConn}})}function socketConn(e){var lastMsg={};socket=io.connect(box.context.msgPushUrl,{"force new connection":true});socket.on("connect",iconnected);socket.on("messages",imessages);socket.on("feedOver",ifeedOver);socket.on("error",ierror);$("#msgPushCloseBtn").click(function(){$("#msgPushDiv").hide()});$("#msgPurchList").click(function(){$("#viewggxx").click();$("#msgPushDiv").hide()});$("#msgPushTitleBtn").click(function(){if(msgContent&&msgContent.length>0){box.closeDialog({content:msgContent})}if(lastMsg.type=="1001"||lastMsg.type=="1002"||lastMsg.type=="1003"){msgContent=box.ich.msg_purch_detail_xxgg(lastMsg.msg);msgContent=box.showDialog({title:"系统消息",content:msgContent,width:780,height:570})}else{if(lastMsg.type=="1004"){msgContent=box.ich.msg_purch_detail_zxfk(lastMsg.msg);msgContent=box.showDialog({title:"咨询/投诉",content:msgContent,width:780,height:570})}}$("#msgPushDiv").hide();msgContent.find("#msgPushInfoCloseBtn").click(function(){box.closeDialog({content:msgContent})})});function iconnected(){var userId="liceid:"+box.user.user_code;socket.emit("identify",{userId:userId,product:"pcpos"})}function imessages(data){var newRefDesc="";if(data&&data.length>0){for(var i=0;i<data.length;i++){if(data[i].type=="message"){change(data[i],1);var msg=jQuery.parseJSON(data[i].content);if(msg.type=="1001"||msg.type=="1002"||msg.type=="1003"){lastMsg=msg;newRefDesc=disposeXXGG();$("#msgPushDiv").find("#msgPushTitle").text("新公告")}else{if(msg.type=="1004"){$("#msgPushDiv").find("#msgPushTitle").text("新回复");lastMsg=msg;newRefDesc=disposeZXFK()}}}}$("#msgPushDiv").find("#msgPushTitleBtn").text(newRefDesc);$("#msgPushDiv").show()}box.console.log("messages:"+$.obj2str(data))}function disposeXXGG(){var newRefDesc="";if(lastMsg&&lastMsg.msg.ref_desc){newRefDesc=lastMsg.msg.ref_desc;if(newRefDesc.length>40){newRefDesc=newRefDesc.substring(0,35);newRefDesc=newRefDesc+"...."}}return newRefDesc}function disposeZXFK(){var newRefDesc="";if(lastMsg&&lastMsg.msg.info_desc){newRefDesc=lastMsg.msg.info_desc;if(newRefDesc.length>40){newRefDesc=newRefDesc.substring(0,35);newRefDesc=newRefDesc+"...."}}return newRefDesc}function ifeedOver(data){box.console.log("feedOver:"+JSON.stringify(data))}function change(msgData,state){socket.emit("feed",{stateId:msgData.stateId,state:state})}function ierror(e){box.console.log("连接错误:"+e)}}return{init:function(){box.listen(HOME.Const.INIT_COMPLETE,loadSocketJs)},destroy:function(){}}});HOME.Core.register("plugin-desktop",function(box){var exitUrl="user/logout";var testUrl="retail/test";var weatherUrl="pub/weather/getWeather";var getUnreadWGDDCountUrl="retail/order/searchUnreadWGDDCount";var context=$("#navwrap");var items=context.find(".navlink");var navbar=$("#navbarcontainer");var navbaritems=navbar.find(".navbaritem");var navbarindex=-1;var exit=$("#exit");var timeout=-1;window.consolelog=function(str){box.console.log(str)};function listener(){items.click(itemClickHandler);navbaritems.click(itemClickHandler);exit.click(exitClickHandler);navbar.hover(showNavbar,hideNavbar);navbar.find(".navbar").hover(function(){navbaritems.removeClass("active");navbarindex=-1});box.keys.push("desktop_onkey");startTest();$(document).on("click","input[type='text']",function(e){e.preventDefault();$(this).select()})}function startTest(){timeout=setTimeout(function(){box.request({url:box.getContextPath()+testUrl,success:onTestComplete,showLoading:false});startTest()},600000)}function onTestComplete(data){box.console.log("test message:"+data.msg);putActivity();getWeather();getUnreadWGDDCount()}function showNavbar(){navbar.stop();navbar.animate({right:"0px"},{easing:"easeOutQuad",duration:300});navbar.find(".navbartop").show()}function hideNavbar(){navbar.stop();navbar.animate({right:"-82px"},300,"easeOutQuad",function(){navbar.find(".navbartop").hide()})}function itemClickHandler(e){var $target=$(e.currentTarget);var module=$target.attr("data-module");if(module){box.notify({type:HOME.Const.SHOW_MODULE,data:{moduleId:module,target:$target}})}}function exitClickHandler(){box.request({url:box.getContextPath()+exitUrl,success:onExitHandler})}function onExitHandler(data){box.showAlert({message:"已注销，将会转向到登录页面！"});setTimeout(function(){window.location.href=data.result},1000)}function onInitComplete(){$("#viewggxx").click();putActivity();setTimeout(function(){putActivity();getWeather();getUnreadWGDDCount()},200)}function putActivity(){var data={path:box.getContextFullPath(),url:'consumer/promotion/searchMerchPromotion?params={"merch_id":"'+box.user.merch_id+'"}'};box.com.commSend({type:"showactivity",message:data})}function getWeather(){box.request({url:box.getContextPath()+weatherUrl,success:onGetWeather,showLoading:false,error:function(){return false}})}function getUnreadWGDDCount(){box.request({url:box.getContextPath()+getUnreadWGDDCountUrl,success:onGetUnreadWGDDCount})}function onGetUnreadWGDDCount(data){if(data.code=="0000"&&data.result){$("#unreadcount").html(data.result)}else{$("#unreadcount").html("0")}}function onGetWeather(data){if(data.code=="0000"&&data.result){box.context.weather=data.result;var whtml=box.ich.widget_weather(box.context.weather);$("#widgetweather").empty().append(whtml.html());box.com.commSend({type:"showweather",message:box.context.weather})}}function onKey(data){switch(data.key){case HOME.Keys.F1:$("#spxs").click();break;case HOME.Keys.F2:$("#jydh").click();break;case HOME.Keys.F3:$("#spgl").click();break;case HOME.Keys.F4:$("#kcgl").click();break;case HOME.Keys.F5:$("#wgdd").click();break;case HOME.Keys.F6:$("#xsgl").click();break;case HOME.Keys.F7:$("#tjfx").click();break;case HOME.Keys.F8:$("#hygl").click();break;case HOME.Keys.F9:$("#yxhd").click();break;case HOME.Keys.F10:$("#ycjt").click();break;case HOME.Keys.F11:$("#zzfw").click();break;case HOME.Keys.F12:$("#dpsz").click();break;case HOME.Keys.LEFT:showNavbar();break;case HOME.Keys.RIGHT:hideNavbar();break;case HOME.Keys.UP:navbarindex--;if(navbarindex<0){navbarindex=navbaritems.length-1}navbaritems.removeClass("active");navbaritems.eq(navbarindex).addClass("active");break;case HOME.Keys.DOWN:navbarindex++;if(navbarindex>=navbaritems.length){navbarindex=0}navbaritems.removeClass("active");navbaritems.eq(navbarindex).addClass("active");break;case HOME.Keys.ENTER:if(navbaritems[navbarindex]){navbaritems.eq(navbarindex).click()}break;case HOME.Keys.TAB:box.notify({type:HOME.Const.SHOW_MODULE,data:{moduleId:"spxs1",target:$("#spxs")}});break}}return{init:function(){listener();box.listen(HOME.Const.INIT_COMPLETE,onInitComplete);box.listen("desktop_onkey",onKey)},destroy:function(){}}});HOME.Core.register("plugin-autoroll",function(box){var list=new Array();var currentOver=null;var timeout=-1;function addRollItem(data){var len=list.length;var b=false;for(var i=0;i<len;i++){if(list[i].id==data.id){itemAddRollItem(list[i],data);b=true;break}}if(!b){var item={id:data.id,count:0,length:1,index:0,trigger:8,ori:"up"};itemAddRollItem(item,data);list.push(item)}}function removeRollItem(data){var len=list.length;for(var i=0;i<len;i++){if(list[i].id==data.id){itemRemoveRollItem(list[i],data);break}}}function itemAddRollItem(item,data){var ele=$("#"+item.id);var ul=ele.find("ul");if(ul.length>0){if(data.position=="before"){ul.prepend(data.tags);item.index++}else{ul.append(data.tags)}}else{ul=$("<ul class='navlinkul'><li>"+ele.html()+"</li></ul>");if(data.position=="before"){ul.prepend(data.tags);item.index++}else{ul.append(data.tags)}ele.empty().append(ul);if(data.count){item.count=data.count}}item.length++;refreshPosition(ul,item)}function itemRemoveRollItem(item,data){var ele=$("#"+item.id);var ul=ele.find("ul");var ls=ul.find("li[data-tag="+data.tag+"]").remove();item.length-=ls.length}function refreshPosition(ul,item){var top=-(item.index*120);ul.css("top",top)}function startTimer(){timeout=setTimeout(onTimer,1000);var context=$("#navwrap");var items=context.find(".navlink");items.hover(function(e){currentOver=$(e.currentTarget)},function(){currentOver=null})}function onTimer(){var len=list.length;for(var i=0;i<len;i++){list[i].count++;if(list[i].count>=list[i].trigger){rollItem(list[i]);list[i].count=0}}timeout=setTimeout(onTimer,1000)}function rollItem(item){if(currentOver&&currentOver.attr("id")==item.id){return}var ele=$("#"+item.id).find("ul");if(item.ori=="down"&&item.index==0){item.ori="up"}else{if(item.ori=="up"&&item.index==item.length-1){item.ori="down"}}if(item.count>1){var offset=null;if(item.ori=="up"){offset="-=120px";item.index++}else{if(item.ori=="down"){offset="+=120px";item.index--}}if(offset){ele.animate({top:offset},{easing:"easeOutQuad",duration:500})}}}function onPause(){clearTimeout(timeout)}function onRestart(){timeout=setTimeout(onTimer,1000)}return{init:function(){box.listen("addRollItem",addRollItem);box.listen("removeRollItem",removeRollItem);box.listen("pauseRoll",onPause);box.listen("restartRoll",onRestart)},destroy:function(){}}});HOME.Core.register("plugin-loadads",function(box){function tobaccoComplete(data){if(box.tobacco.params){var beginDate=new Date(box.tobacco.params.order_begintime.substr(0,4),box.tobacco.params.order_begintime.substr(4,2)-1,box.tobacco.params.order_begintime.substr(6,2),box.tobacco.params.order_begintime.substr(9,2),box.tobacco.params.order_begintime.substr(12,2));var endDate=new Date(box.tobacco.params.order_endtime.substr(0,4),box.tobacco.params.order_endtime.substr(4,2)-1,box.tobacco.params.order_endtime.substr(6,2),box.tobacco.params.order_endtime.substr(9,2),box.tobacco.params.order_endtime.substr(12,2));box.tobacco.params.order_begintime_format=beginDate.format("yyyy-MM-dd hh:mm");box.tobacco.params.order_endtime_format=endDate.format("yyyy-MM-dd hh:mm");$("#ordertime").html("开始："+box.tobacco.params.order_begintime_format+"<br />结束："+box.tobacco.params.order_endtime_format)}}function initComplete(){}return{init:function(){box.listen(HOME.Const.INIT_COMPLETE,initComplete);box.listen(HOME.Const.TOBACCO_COMPLETE,tobaccoComplete)},destroy:function(){}}});HOME.Core.register("plugin-skins",function(box){var skins=$("#skins");var skinlist=null;var datas=[{title:"1",tag:"beijing1"},{title:"2",tag:"beijing2"},{title:"3",tag:"beijing3"},{title:"4",tag:"beijing4"},{title:"5",tag:"beijing5"},{title:"6",tag:"beijing6"},{title:"7",tag:"beijing7"},{title:"8",tag:"beijing8"},{title:"9",tag:"beijing9"}];var timeout=-1;function listener(){var item=null;for(var i=0;i<datas.length;i++){item=datas[i];item.url=box.getContextPath()+"public/retail/themes/bg/"+item.tag+".jpg";item.small_url="bgIcon bgIcon_"+item.tag}skinlist=box.ich.back_skin({list:datas});skins.append(skinlist);skinlist=skins.find(".back_skin");skins.hover(function(){timeout=setTimeout(function(){skinlist.show()},300)},function(){clearTimeout(timeout);timeout=-1;skinlist.hide()});skinlist.find("li a").click(onThemeClick)}function onThemeClick(e){var $tag=$(e.currentTarget);var url=$tag.attr("data-url");$.setCookie("back_url",url);$("body").css("background-image","url('"+url+"')");$.checkInShell(function(b){if(b){setTimeout(function(){$("body").css("background-image","url('"+url+"')")},100)}})}return{init:function(){box.listen(HOME.Const.INIT_COMPLETE,listener)},destroy:function(){}}});HOME.Core.register("plugin-module",function(box){var modules=null;var currentRootModule=null;var currentModule=null;var currentWindow=null;var isShow=false;var showfooter=false;function initModule(){modules=box.user.permit;var list=new Array();var objtmp=new Object();if(modules&&modules.length>0){for(var i in modules){setModuleUrl(modules[i]);if(!modules[i].parent_id){modules[i].children=[];list.push(modules[i]);objtmp[modules[i].module_id]=modules[i];if(modules[i].haspage=="1"){modules[i].quick_key="F1";modules[i].children=[modules[i]]}}}for(var i in modules){var pid=modules[i].parent_id;if(pid){if(!objtmp[pid].children){objtmp[pid].children=[]}objtmp[pid].children.push(modules[i]);modules[i].quick_key="F"+objtmp[pid].children.length}}for(var index in list){if(list[index].children.length==1){list[index].children[0].quick_key=""}}modules=list}else{box.showAlert({message:"未获取到模块权限"})}}function setModuleUrl(m){if(m.multi=="1"){m.jsurl="public/retail/multi/"+box.user.com_id+"/module/"+m.module_id+"/"+m.module_id+".js";m.templateurl="public/retail/multi/"+box.user.com_id+"/module/"+m.module_id+"/"+m.module_id+".html";m.icon="navbarIcon navbarIcon_"+m.module_id}else{m.jsurl="public/retail/module/"+m.module_id+"/"+m.module_id+".js";m.templateurl="public/retail/module/"+m.module_id+"/"+m.module_id+".html";m.icon="navbarIcon navbarIcon_"+m.module_id}}function checkModule(data){var rootModule=null;var module=null;var m,m2;for(var i in modules){m=modules[i];if(m.module_id==data.moduleId){rootModule=m;if(m.haspage=="1"){module=m}else{if(m.children){module=m.children[0]}else{box.showAlert({message:"您没有权限访问该功能！"})}}break}for(var j in m.children){m2=m.children[j];if(m2.module_id==data.moduleId){module=m2;rootModule=m;break}}if(module){break}}if(module){var back=data.target.attr("data-background");if(!back){back=data.target.css("background-color")}module.style={background:back};var w=data.target.attr("data-width");if(w){module.style.width=w}if(data.target.param){module.param=data.target.param}showModule(rootModule,module)}else{box.showAlert({message:"您没有权限访问该功能！"})}}function loadModule(rootModule,module,windowContent){if(module.isload){startModule(rootModule,module,windowContent)}else{box.notify({type:HOME.Const.LOAD_TEMPLATE,data:{url:module.templateurl,success:onLoadTemplateSuccess(rootModule,module,windowContent)}})}}function onLoadTemplateSuccess(rootModule,module,windowContent){return function(){box.notify({type:HOME.Const.LOAD_JSPLUGINS,data:{url:module.jsurl,success:onLoadJSSuccess(rootModule,module,windowContent)}})}}function onLoadJSSuccess(rootModule,module,windowContent){return function(){module.isload=true;startModule(rootModule,module,windowContent)}}function startModule(rootModule,module,windowContent){box.notify({type:module.module_id,data:windowContent})}function showModule(rootModule,module){if(currentModule&&currentModule.module_id==module.module_id){return}box.console.log("打开模块："+module.module_id);if(module.module_id=="sjkd"){box.com.openSJKD();return}if(currentRootModule&&currentRootModule.module_id!=rootModule.module_id){return}if(currentModule&&currentModule.module_id!=module.module_id){var b=box.notify({type:currentModule.module_id+"_close",data:{content:currentWindow,callback:function(){createModule(rootModule,module)}}});if(b){createModule(rootModule,module)}}else{createModule(rootModule,module)}}function createModule(rootModule,module){if(!currentRootModule||currentRootModule.module_id!=rootModule.module_id){currentRootModule=rootModule;var windowHeader=box.ich.r_window_header(rootModule);currentWindow=box.ich.r_window({header:windowHeader[0].outerHTML})}if(!isShow){isShow=true;var dataobj={title:module.title,content:currentWindow,close:onCloseModule};if(module.style&&module.style.width){dataobj.width=module.style.width}if(module.param){$.extend(dataobj,module.param)}currentWindow=box.showLayer(dataobj);if(module.style){currentWindow.find(".window_header").css("background-color",module.style.background)}currentWindow.closest(".ui-resizable").resize(function(){resizeWindow(currentWindow)});currentWindow.find(".window_close").click(closeModule);listenerWindowHeader(currentWindow)}if(currentRootModule.children.length>1){currentWindow.removeClass("single")}else{currentWindow.addClass("single")}currentWindow.removeClass("haspager");currentWindow.removeClass("hasadsearch");var highsearcher1=currentWindow.find(".window_search");if(highsearcher1.is(":visible")){highsearcher1.hide()}currentWindow.find(".window_header_item").removeClass("selected");currentWindow.find(".window_header_item[data-module="+module.module_id+"]").addClass("selected");if(!currentModule||currentModule.module_id!=module.module_id){currentModule=module;var windowContent=currentWindow.find(".window_content");var windowHeaderTip=currentWindow.find(".window_header_tip");var windowMessage=currentWindow.find(".window_message");var windowPager=currentWindow.find(".window_pager");var highsearcher=currentWindow.find(".window_search");windowContent.empty().append(getLoadingTag());showfooter=false;windowContent.showFooter=function(b){showfooter=b;resizeWindow(currentWindow)};windowContent.setHeaderTip=function(d){windowHeaderTip.empty().append(d)};windowContent.showMessage=function(param){if(param.content){var parentTop=param.content.offset().top;var parentLeft=param.content.offset().left;var parentWidth=param.content.width();var parentHeight=param.content.height();var width=windowMessage.width();var height=windowMessage.height();if(param.message){windowMessage.html(param.message)}else{windowMessage.html("")}windowMessage.show();windowMessage.offset({top:parentTop+(parentHeight/2-height/2)<300?300:(parentHeight/2-height/2),left:parentLeft+(parentWidth/2-width/2)<450?450:(parentWidth/2-width/2)})}};windowContent.closeMessage=function(){windowMessage.hide()};windowContent.hideHighSearch=function(){if(highsearcher.is(":visible")){highsearcher.fadeOut()}};windowContent.showHighSearch=function(width,height,margintop,context){highsearcher.fadeIn();highsearcher.attr("id","window_search");highsearcher.css("width",width);highsearcher.css("height",height);highsearcher.css("margin-top",margintop);if(highsearcher.children().size()==0){highsearcher.append(context)}listenHighSearch(windowContent)};windowContent.unbind("empty").bind("empty",function(e){if(e.target==e.currentTarget){currentWindow.find(".window_content_cont").scrollTop(0)}});windowContent.showPager=function(pager,showpage){if(!currentWindow){return}var prev=windowPager.find(".window_pager_prev");var next=windowPager.find(".window_pager_next");var start=windowPager.find(".window_pager_start");var count=windowPager.find(".window_pager_count");var pageIndex=windowPager.find(".window_pager_index");var pageUpdate=windowPager.find(".window_pager_update");var pageFirst=windowPager.find(".window_pager_first");var pageLast=windowPager.find(".window_pager_last");var pageCustom=windowPager.find(".window_pager_custom");prev.unbind("click").attr("disabled",false).removeClass("disabled");next.unbind("click").attr("disabled",false).removeClass("disabled");pager.page_index=parseInt(pager.page_index);pager.page_size=parseInt(pager.page_size);pager.page_count=parseInt(pager.page_count);pager.count=parseInt(pager.count);if(pager.page_count<=0){pager.page_count=1}start.text(pager.page_index);count.text(pager.page_count);currentWindow.addClass("haspager");if(pager&&pager.page_index<=1){prev.attr("disabled",true).addClass("disabled")}if(pager&&pager.page_index>=pager.page_count){next.attr("disabled",true).addClass("disabled")}prev.unbind("click").click(function(){pageUpdate.hide();var i=pager.page_index-1;if(i<1){return}if(showpage){var obj={page_index:i,page_size:pager.page_size};showpage(obj)}currentWindow.find(".window_footer").height(60);resizeWindow(currentWindow)});next.unbind("click").click(function(){pageUpdate.hide();var i=pager.page_index+1;if(i>pager.page_count){return}if(showpage){var obj={page_index:i,page_size:pager.page_size};showpage(obj)}currentWindow.find(".window_footer").height(60);resizeWindow(currentWindow)});pageIndex.unbind("click").click(function(){pageUpdate.show();pageCustom.val("");pageCustom.focus().select()});pageFirst.unbind("click").click(function(){pageCustom.val("");var i=1;if(i>pager.page_count){return}if(showpage){var obj={page_index:i,page_size:pager.page_size};showpage(obj)}currentWindow.find(".window_footer").height(60);resizeWindow(currentWindow);pageUpdate.hide()});pageLast.unbind("click").click(function(){pageCustom.val("");var i=pager.page_count;if(i>pager.page_count){return}if(showpage){var obj={page_index:i,page_size:pager.page_size};showpage(obj)}currentWindow.find(".window_footer").height(60);resizeWindow(currentWindow);pageUpdate.hide()});pageCustom.unbind("change").change(function(){var i=parseInt(pageCustom.val());if(i>pager.page_count||i==0){box.showAlert({message:"很抱歉，所输入的页码不能小于1大于"+pager.page_count+"！"})}else{if(showpage){var obj={page_index:i,page_size:pager.page_size};showpage(obj)}currentWindow.find(".window_footer").height(60);resizeWindow(currentWindow)}pageUpdate.hide()});$(document).click(function(e){var tar=e.target;if(!($(tar).hasClass("window_pager")||$(tar).parents().hasClass("window_pager"))){pageUpdate.hide()}})};windowContent.hidePager=function(){if(!currentWindow){return}currentWindow.removeClass("haspager")};windowContent.showAdvancedSearch=function(){if(!currentWindow){return}currentWindow.addClass("hasadsearch");var search=currentWindow.find("#footer_adSearch");var state=search.attr("data-state");if(state=="down"){windowContent.advancedOpen(search)}else{windowContent.advancedClose(search)}search.unbind("click").click(function(){if(search.attr("data-state")=="up"){windowContent.advancedOpen(search)}else{windowContent.advancedClose(search)}})};windowContent.advancedOpen=function(search){search.find("span").removeClass("pageIcon_upArrrow").addClass("pageIcon_downArrrow");search.attr("data-state","down");search.attr("title","合并");currentWindow.find(".view_footer").css("height","100px");currentWindow.find(".view_adSearch").show();currentWindow.find(".window_footer").height(100);resizeWindow(currentWindow)};windowContent.advancedClose=function(search){search.find("span").removeClass("pageIcon_downArrrow").addClass("pageIcon_upArrrow");search.attr("data-state","up");search.attr("title","展开");currentWindow.find(".view_footer").css("height","60px");currentWindow.find(".view_adSearch").hide();currentWindow.find(".window_footer").height(60);resizeWindow(currentWindow)};windowContent.hideAdvancedSearch=function(){if(!currentWindow){return}currentWindow.find(".window_footer").height(60);resizeWindow(currentWindow);currentWindow.removeClass("hasadsearch")};loadModule(rootModule,module,windowContent)}resizeWindow(currentWindow)}function listenHighSearch(windowContent){$(document).bind("click",function(e){if($(e.target).closest("#window_search").length==0&&e.target.id!="highSearch"){windowContent.hideHighSearch()}})}function listenerWindowHeader(context){context.find(".subnavlink").unbind("click",itemClickHandler).click(itemClickHandler);box.keys.push("layer_onkey")}function itemClickHandler(e){var $target=$(e.currentTarget);var module=$target.attr("data-module");box.notify({type:HOME.Const.SHOW_MODULE,data:{moduleId:module,target:$target}})}function resizeWindow(win){if(win){var header=win.find(".window_header");var footer=win.find(".window_footer");var content=win.find(".window_content_cont");content.height(win.height()-header.height()-(showfooter?footer.height():0));content.trigger("footer_resize")}}function closeModule(){box.console.log("关闭模块："+currentModule.module_id);var b=box.notify({type:currentModule.module_id+"_close",data:{content:currentWindow,callback:function(){box.notify({type:HOME.Const.CLOSE_LAYER,data:{content:currentWindow}})}}});if(b){box.notify({type:HOME.Const.CLOSE_LAYER,data:{content:currentWindow}})}}function onCloseModule(){isShow=false;currentModule=null;currentRootModule=null;if(currentWindow){currentWindow.find(".window_close").unbind("click",closeModule);currentWindow=null}box.keys.popToFirst()}function getLoadingTag(){return"<div style='margin:0 auto; padding-top: 180px; text-align:center; font-size: 18px'>正在加载...</div>"}function desktopOnKey(data){switch(data.key){case HOME.Keys.BARCODE:if(!currentModule){$("#spxs").click()}break}}function onKey(data){var widgets=null;if(currentWindow){widgets=currentWindow.find("[data-onkey=true]")}var b=false;switch(data.key){case HOME.Keys.ESC:closeModule();break;case HOME.Keys.PAGEUP:if(currentWindow&&currentWindow.length){currentWindow.find(".window_pager_prev").click()}break;case HOME.Keys.PAGEDOWN:if(currentWindow&&currentWindow.length){currentWindow.find(".window_pager_next").click()}break;case HOME.Keys.F1:b=showChildModule(0);if(b){break}case HOME.Keys.F2:b=showChildModule(1);if(b){break}case HOME.Keys.F3:b=showChildModule(2);if(b){break}case HOME.Keys.F4:b=showChildModule(3);if(b){break}case HOME.Keys.F5:b=showChildModule(4);if(b){break}case HOME.Keys.F6:b=showChildModule(5);if(b){break}case HOME.Keys.F7:b=showChildModule(6);if(b){break}case HOME.Keys.F8:b=showChildModule(7);if(b){break}case HOME.Keys.F9:b=showChildModule(8);if(b){break}case HOME.Keys.F10:b=showChildModule(9);if(b){break}case HOME.Keys.F11:b=showChildModule(10);if(b){break}case HOME.Keys.F12:b=showChildModule(11);if(b){break}default:if(widgets&&widgets.length){if(typeof box.keys.widgetOnkey!="undefined"){b=box.keys.widgetOnkey(widgets,data)}}if(!b&&currentModule){box.notify({type:currentModule.module_id+"_onkey",data:data})}break}}function showChildModule(index){var b=false;if(currentWindow){var list=currentWindow.find(".subnavlink");if(list&&list[index]){b=true;$(list[index]).click()}}return b}return{init:function(){box.listen(HOME.Const.SHOW_MODULE,checkModule);box.listen(HOME.Const.CLOSE_MODULE,closeModule);box.listen("desktop_onkey",desktopOnKey);box.listen("layer_onkey",onKey);initModule()},destroy:function(){}}});HOME.Core.register("plugin-widgetonkey",function(box){var lastView=null,parentView=null,theadView=null;var parentHeight=0,viewHeight=0,rowHeight=0,parentOffset=0;function load(){box.keys.widgetOnkey=widgetOnkey}function widgetOnkey(widgets,data){var b=false;var w=null;for(var i=0;i<widgets.length;i++){w=widgets.eq(i);if(w.hasClass("table_view")){if(w[0].id&&w[0].id.indexOf("fixedtable")!=-1){continue}b|=tableviewOnkey(w,data)}else{if(w.hasClass("list_view")){b|=listviewOnkey(w,data)}}}return b}function tableviewOnkey(view,data){var row=view.find(".selectRow");switch(data.key){case HOME.Keys.UP:row.removeClass("selectRow");if(row.length){row=row.prev()}else{row=view.find("tbody tr:last")}row.addClass("selectRow");moveScroll(view,row,false);row.select();if(row.find("input").length!==0){row.find("input:first").focus().select()}return true;case HOME.Keys.DOWN:row.removeClass("selectRow");if(row.length){row=row.next()}else{row=view.find("tbody tr:first")}row.addClass("selectRow");moveScroll(view,row,true);row.select();if(row.find("input").length!==0){row.find("input:first").focus().select()}return true;case HOME.Keys.ENTER:row.click();return true}}function listviewOnkey(view,data){var row=view.find(".selectRow");switch(data.key){case HOME.Keys.UP:row.removeClass("selectRow");if(row.length){row=row.prev()}else{row=view.find("li:last")}row.addClass("selectRow");moveScroll(view,row,false);row.select();return true;case HOME.Keys.DOWN:row.removeClass("selectRow");if(row.length){row=row.next()}else{row=view.find("li:first")}row.addClass("selectRow");moveScroll(view,row,true);row.select();return true;case HOME.Keys.ENTER:row.click();return true}}function moveScroll(view,row,down){if(!row.length){return false}if(lastView!=view){lastView=view;viewHeight=lastView.outerHeight();theadView=lastView.find("thead");parentView=view.parent();parentHeight=parentView.height();if(parentHeight==viewHeight){parentView=view.parent().parent();parentHeight=parentView.height();if(parentHeight==viewHeight){parentView=lastView.closest(".window_content_cont");parentHeight=parentView.height()}}var pp=parentView.css("position");if(pp!="absolute"&&pp!="relative"){parentOffset=parentView.position().top}else{parentOffset=0}}rowHeight=row.height();var position=row.position();if(parentHeight<viewHeight){if(down){if(position.top+rowHeight-parentOffset>parentHeight){parentView.scrollTop(position.top+rowHeight-parentHeight-parentOffset+parentView.scrollTop())}else{if(position.top-parentOffset<parentView.scrollTop()){parentView.scrollTop(position.top-parentOffset+parentView.scrollTop()-rowHeight)}}}else{rowHeight=theadView.height();if(position.top-rowHeight-parentOffset<0){parentView.scrollTop(parentView.scrollTop()+position.top-parentOffset-rowHeight)}else{if(position.top-parentOffset>parentHeight){parentView.scrollTop(position.top+rowHeight-parentHeight-parentOffset+parentView.scrollTop())}}}}}return{init:function(){load()},destroy:function(){}}});function desEnc(data){var firstKey="KLJOIUYIUYIU";var secondKey="718937839463287";var thirdKey="&$%%$%^(()^&";return strEnc(data,firstKey,secondKey,thirdKey)}function strEnc(data,firstKey,secondKey,thirdKey){var leng=data.length;var encData="";var firstKeyBt,secondKeyBt,thirdKeyBt,firstLength,secondLength,thirdLength;if(firstKey!=null&&firstKey!=""){firstKeyBt=getKeyBytes(firstKey);firstLength=firstKeyBt.length}if(secondKey!=null&&secondKey!=""){secondKeyBt=getKeyBytes(secondKey);secondLength=secondKeyBt.length}if(thirdKey!=null&&thirdKey!=""){thirdKeyBt=getKeyBytes(thirdKey);thirdLength=thirdKeyBt.length}if(leng>0){if(leng<4){var bt=strToBt(data);var encByte;if(firstKey!=null&&firstKey!=""&&secondKey!=null&&secondKey!=""&&thirdKey!=null&&thirdKey!=""){var tempBt;var x,y,z;tempBt=bt;for(x=0;x<firstLength;x++){tempBt=enc(tempBt,firstKeyBt[x])}for(y=0;y<secondLength;y++){tempBt=enc(tempBt,secondKeyBt[y])}for(z=0;z<thirdLength;z++){tempBt=enc(tempBt,thirdKeyBt[z])}encByte=tempBt}else{if(firstKey!=null&&firstKey!=""&&secondKey!=null&&secondKey!=""){var tempBt;var x,y;tempBt=bt;for(x=0;x<firstLength;x++){tempBt=enc(tempBt,firstKeyBt[x])}for(y=0;y<secondLength;y++){tempBt=enc(tempBt,secondKeyBt[y])}encByte=tempBt}else{if(firstKey!=null&&firstKey!=""){var tempBt;var x=0;tempBt=bt;for(x=0;x<firstLength;x++){tempBt=enc(tempBt,firstKeyBt[x])}encByte=tempBt}}}encData=bt64ToHex(encByte)}else{var iterator=parseInt(leng/4);var remainder=leng%4;var i=0;for(i=0;i<iterator;i++){var tempData=data.substring(i*4+0,i*4+4);var tempByte=strToBt(tempData);var encByte;if(firstKey!=null&&firstKey!=""&&secondKey!=null&&secondKey!=""&&thirdKey!=null&&thirdKey!=""){var tempBt;var x,y,z;tempBt=tempByte;for(x=0;x<firstLength;x++){tempBt=enc(tempBt,firstKeyBt[x])}for(y=0;y<secondLength;y++){tempBt=enc(tempBt,secondKeyBt[y])}for(z=0;z<thirdLength;z++){tempBt=enc(tempBt,thirdKeyBt[z])}encByte=tempBt}else{if(firstKey!=null&&firstKey!=""&&secondKey!=null&&secondKey!=""){var tempBt;var x,y;tempBt=tempByte;for(x=0;x<firstLength;x++){tempBt=enc(tempBt,firstKeyBt[x])}for(y=0;y<secondLength;y++){tempBt=enc(tempBt,secondKeyBt[y])}encByte=tempBt}else{if(firstKey!=null&&firstKey!=""){var tempBt;var x;tempBt=tempByte;for(x=0;x<firstLength;x++){tempBt=enc(tempBt,firstKeyBt[x])}encByte=tempBt}}}encData+=bt64ToHex(encByte)}if(remainder>0){var remainderData=data.substring(iterator*4+0,leng);var tempByte=strToBt(remainderData);var encByte;if(firstKey!=null&&firstKey!=""&&secondKey!=null&&secondKey!=""&&thirdKey!=null&&thirdKey!=""){var tempBt;var x,y,z;tempBt=tempByte;for(x=0;x<firstLength;x++){tempBt=enc(tempBt,firstKeyBt[x])}for(y=0;y<secondLength;y++){tempBt=enc(tempBt,secondKeyBt[y])}for(z=0;z<thirdLength;z++){tempBt=enc(tempBt,thirdKeyBt[z])}encByte=tempBt}else{if(firstKey!=null&&firstKey!=""&&secondKey!=null&&secondKey!=""){var tempBt;var x,y;tempBt=tempByte;for(x=0;x<firstLength;x++){tempBt=enc(tempBt,firstKeyBt[x])}for(y=0;y<secondLength;y++){tempBt=enc(tempBt,secondKeyBt[y])}encByte=tempBt}else{if(firstKey!=null&&firstKey!=""){var tempBt;var x;tempBt=tempByte;for(x=0;x<firstLength;x++){tempBt=enc(tempBt,firstKeyBt[x])}encByte=tempBt}}}encData+=bt64ToHex(encByte)}}}return encData}function strDec(data,firstKey,secondKey,thirdKey){var leng=data.length;var decStr="";var firstKeyBt,secondKeyBt,thirdKeyBt,firstLength,secondLength,thirdLength;if(firstKey!=null&&firstKey!=""){firstKeyBt=getKeyBytes(firstKey);firstLength=firstKeyBt.length}if(secondKey!=null&&secondKey!=""){secondKeyBt=getKeyBytes(secondKey);secondLength=secondKeyBt.length}if(thirdKey!=null&&thirdKey!=""){thirdKeyBt=getKeyBytes(thirdKey);thirdLength=thirdKeyBt.length}var iterator=parseInt(leng/16);var i=0;for(i=0;i<iterator;i++){var tempData=data.substring(i*16+0,i*16+16);var strByte=hexToBt64(tempData);var intByte=new Array(64);var j=0;for(j=0;j<64;j++){intByte[j]=parseInt(strByte.substring(j,j+1))}var decByte;if(firstKey!=null&&firstKey!=""&&secondKey!=null&&secondKey!=""&&thirdKey!=null&&thirdKey!=""){var tempBt;var x,y,z;tempBt=intByte;for(x=thirdLength-1;x>=0;x--){tempBt=dec(tempBt,thirdKeyBt[x])}for(y=secondLength-1;y>=0;y--){tempBt=dec(tempBt,secondKeyBt[y])}for(z=firstLength-1;z>=0;z--){tempBt=dec(tempBt,firstKeyBt[z])}decByte=tempBt}else{if(firstKey!=null&&firstKey!=""&&secondKey!=null&&secondKey!=""){var tempBt;var x,y,z;tempBt=intByte;for(x=secondLength-1;x>=0;x--){tempBt=dec(tempBt,secondKeyBt[x])}for(y=firstLength-1;y>=0;y--){tempBt=dec(tempBt,firstKeyBt[y])}decByte=tempBt}else{if(firstKey!=null&&firstKey!=""){var tempBt;var x,y,z;tempBt=intByte;for(x=firstLength-1;x>=0;x--){tempBt=dec(tempBt,firstKeyBt[x])}decByte=tempBt}}}decStr+=byteToString(decByte)}return decStr}function getKeyBytes(key){var keyBytes=new Array();var leng=key.length;var iterator=parseInt(leng/4);var remainder=leng%4;var i=0;for(i=0;i<iterator;i++){keyBytes[i]=strToBt(key.substring(i*4+0,i*4+4))}if(remainder>0){keyBytes[i]=strToBt(key.substring(i*4+0,leng))}return keyBytes}function strToBt(str){var leng=str.length;var bt=new Array(64);if(leng<4){var i=0,j=0,p=0,q=0;for(i=0;i<leng;i++){var k=str.charCodeAt(i);for(j=0;j<16;j++){var pow=1,m=0;for(m=15;m>j;m--){pow*=2}bt[16*i+j]=parseInt(k/pow)%2}}for(p=leng;p<4;p++){var k=0;for(q=0;q<16;q++){var pow=1,m=0;for(m=15;m>q;m--){pow*=2}bt[16*p+q]=parseInt(k/pow)%2}}}else{for(i=0;i<4;i++){var k=str.charCodeAt(i);for(j=0;j<16;j++){var pow=1;for(m=15;m>j;m--){pow*=2}bt[16*i+j]=parseInt(k/pow)%2}}}return bt}function bt4ToHex(binary){var hex;switch(binary){case"0000":hex="0";break;case"0001":hex="1";break;case"0010":hex="2";break;case"0011":hex="3";break;case"0100":hex="4";break;case"0101":hex="5";break;case"0110":hex="6";break;case"0111":hex="7";break;case"1000":hex="8";break;case"1001":hex="9";break;case"1010":hex="A";break;case"1011":hex="B";break;case"1100":hex="C";break;case"1101":hex="D";break;case"1110":hex="E";break;case"1111":hex="F";break}return hex}function hexToBt4(hex){var binary;switch(hex){case"0":binary="0000";break;case"1":binary="0001";break;case"2":binary="0010";break;case"3":binary="0011";break;case"4":binary="0100";break;case"5":binary="0101";break;case"6":binary="0110";break;case"7":binary="0111";break;case"8":binary="1000";break;case"9":binary="1001";break;case"A":binary="1010";break;case"B":binary="1011";break;case"C":binary="1100";break;case"D":binary="1101";break;case"E":binary="1110";break;case"F":binary="1111";break}return binary}function byteToString(byteData){var str="";for(i=0;i<4;i++){var count=0;for(j=0;j<16;j++){var pow=1;for(m=15;m>j;m--){pow*=2}count+=byteData[16*i+j]*pow}if(count!=0){str+=String.fromCharCode(count)}}return str}function bt64ToHex(byteData){var hex="";for(i=0;i<16;i++){var bt="";for(j=0;j<4;j++){bt+=byteData[i*4+j]}hex+=bt4ToHex(bt)}return hex}function hexToBt64(hex){var binary="";for(i=0;i<16;i++){binary+=hexToBt4(hex.substring(i,i+1))}return binary}function enc(dataByte,keyByte){var keys=generateKeys(keyByte);var ipByte=initPermute(dataByte);var ipLeft=new Array(32);var ipRight=new Array(32);var tempLeft=new Array(32);var i=0,j=0,k=0,m=0,n=0;for(k=0;k<32;k++){ipLeft[k]=ipByte[k];ipRight[k]=ipByte[32+k]}for(i=0;i<16;i++){for(j=0;j<32;j++){tempLeft[j]=ipLeft[j];ipLeft[j]=ipRight[j]}var key=new Array(48);for(m=0;m<48;m++){key[m]=keys[i][m]}var tempRight=xor(pPermute(sBoxPermute(xor(expandPermute(ipRight),key))),tempLeft);for(n=0;n<32;n++){ipRight[n]=tempRight[n]}}var finalData=new Array(64);for(i=0;i<32;i++){finalData[i]=ipRight[i];finalData[32+i]=ipLeft[i]}return finallyPermute(finalData)}function dec(dataByte,keyByte){var keys=generateKeys(keyByte);var ipByte=initPermute(dataByte);var ipLeft=new Array(32);var ipRight=new Array(32);var tempLeft=new Array(32);var i=0,j=0,k=0,m=0,n=0;for(k=0;k<32;k++){ipLeft[k]=ipByte[k];ipRight[k]=ipByte[32+k]}for(i=15;i>=0;i--){for(j=0;j<32;j++){tempLeft[j]=ipLeft[j];ipLeft[j]=ipRight[j]}var key=new Array(48);for(m=0;m<48;m++){key[m]=keys[i][m]}var tempRight=xor(pPermute(sBoxPermute(xor(expandPermute(ipRight),key))),tempLeft);for(n=0;n<32;n++){ipRight[n]=tempRight[n]}}var finalData=new Array(64);for(i=0;i<32;i++){finalData[i]=ipRight[i];finalData[32+i]=ipLeft[i]}return finallyPermute(finalData)}function initPermute(originalData){var ipByte=new Array(64);for(i=0,m=1,n=0;i<4;i++,m+=2,n+=2){for(j=7,k=0;j>=0;j--,k++){ipByte[i*8+k]=originalData[j*8+m];ipByte[i*8+k+32]=originalData[j*8+n]}}return ipByte}function expandPermute(rightData){var epByte=new Array(48);for(i=0;i<8;i++){if(i==0){epByte[i*6+0]=rightData[31]}else{epByte[i*6+0]=rightData[i*4-1]}epByte[i*6+1]=rightData[i*4+0];epByte[i*6+2]=rightData[i*4+1];epByte[i*6+3]=rightData[i*4+2];epByte[i*6+4]=rightData[i*4+3];if(i==7){epByte[i*6+5]=rightData[0]}else{epByte[i*6+5]=rightData[i*4+4]}}return epByte}function xor(byteOne,byteTwo){var xorByte=new Array(byteOne.length);for(i=0;i<byteOne.length;i++){xorByte[i]=byteOne[i]^byteTwo[i]}return xorByte}function sBoxPermute(expandByte){var sBoxByte=new Array(32);var binary="";var s1=[[14,4,13,1,2,15,11,8,3,10,6,12,5,9,0,7],[0,15,7,4,14,2,13,1,10,6,12,11,9,5,3,8],[4,1,14,8,13,6,2,11,15,12,9,7,3,10,5,0],[15,12,8,2,4,9,1,7,5,11,3,14,10,0,6,13]];var s2=[[15,1,8,14,6,11,3,4,9,7,2,13,12,0,5,10],[3,13,4,7,15,2,8,14,12,0,1,10,6,9,11,5],[0,14,7,11,10,4,13,1,5,8,12,6,9,3,2,15],[13,8,10,1,3,15,4,2,11,6,7,12,0,5,14,9]];var s3=[[10,0,9,14,6,3,15,5,1,13,12,7,11,4,2,8],[13,7,0,9,3,4,6,10,2,8,5,14,12,11,15,1],[13,6,4,9,8,15,3,0,11,1,2,12,5,10,14,7],[1,10,13,0,6,9,8,7,4,15,14,3,11,5,2,12]];var s4=[[7,13,14,3,0,6,9,10,1,2,8,5,11,12,4,15],[13,8,11,5,6,15,0,3,4,7,2,12,1,10,14,9],[10,6,9,0,12,11,7,13,15,1,3,14,5,2,8,4],[3,15,0,6,10,1,13,8,9,4,5,11,12,7,2,14]];var s5=[[2,12,4,1,7,10,11,6,8,5,3,15,13,0,14,9],[14,11,2,12,4,7,13,1,5,0,15,10,3,9,8,6],[4,2,1,11,10,13,7,8,15,9,12,5,6,3,0,14],[11,8,12,7,1,14,2,13,6,15,0,9,10,4,5,3]];var s6=[[12,1,10,15,9,2,6,8,0,13,3,4,14,7,5,11],[10,15,4,2,7,12,9,5,6,1,13,14,0,11,3,8],[9,14,15,5,2,8,12,3,7,0,4,10,1,13,11,6],[4,3,2,12,9,5,15,10,11,14,1,7,6,0,8,13]];var s7=[[4,11,2,14,15,0,8,13,3,12,9,7,5,10,6,1],[13,0,11,7,4,9,1,10,14,3,5,12,2,15,8,6],[1,4,11,13,12,3,7,14,10,15,6,8,0,5,9,2],[6,11,13,8,1,4,10,7,9,5,0,15,14,2,3,12]];var s8=[[13,2,8,4,6,15,11,1,10,9,3,14,5,0,12,7],[1,15,13,8,10,3,7,4,12,5,6,11,0,14,9,2],[7,11,4,1,9,12,14,2,0,6,10,13,15,3,5,8],[2,1,14,7,4,10,8,13,15,12,9,0,3,5,6,11]];for(m=0;m<8;m++){var i=0,j=0;i=expandByte[m*6+0]*2+expandByte[m*6+5];j=expandByte[m*6+1]*2*2*2+expandByte[m*6+2]*2*2+expandByte[m*6+3]*2+expandByte[m*6+4];switch(m){case 0:binary=getBoxBinary(s1[i][j]);break;case 1:binary=getBoxBinary(s2[i][j]);break;case 2:binary=getBoxBinary(s3[i][j]);break;case 3:binary=getBoxBinary(s4[i][j]);break;case 4:binary=getBoxBinary(s5[i][j]);break;case 5:binary=getBoxBinary(s6[i][j]);break;case 6:binary=getBoxBinary(s7[i][j]);break;case 7:binary=getBoxBinary(s8[i][j]);break}sBoxByte[m*4+0]=parseInt(binary.substring(0,1));sBoxByte[m*4+1]=parseInt(binary.substring(1,2));sBoxByte[m*4+2]=parseInt(binary.substring(2,3));sBoxByte[m*4+3]=parseInt(binary.substring(3,4))}return sBoxByte}function pPermute(sBoxByte){var pBoxPermute=new Array(32);pBoxPermute[0]=sBoxByte[15];pBoxPermute[1]=sBoxByte[6];pBoxPermute[2]=sBoxByte[19];pBoxPermute[3]=sBoxByte[20];pBoxPermute[4]=sBoxByte[28];pBoxPermute[5]=sBoxByte[11];pBoxPermute[6]=sBoxByte[27];pBoxPermute[7]=sBoxByte[16];pBoxPermute[8]=sBoxByte[0];pBoxPermute[9]=sBoxByte[14];pBoxPermute[10]=sBoxByte[22];pBoxPermute[11]=sBoxByte[25];pBoxPermute[12]=sBoxByte[4];pBoxPermute[13]=sBoxByte[17];pBoxPermute[14]=sBoxByte[30];pBoxPermute[15]=sBoxByte[9];pBoxPermute[16]=sBoxByte[1];pBoxPermute[17]=sBoxByte[7];pBoxPermute[18]=sBoxByte[23];pBoxPermute[19]=sBoxByte[13];pBoxPermute[20]=sBoxByte[31];pBoxPermute[21]=sBoxByte[26];pBoxPermute[22]=sBoxByte[2];pBoxPermute[23]=sBoxByte[8];pBoxPermute[24]=sBoxByte[18];pBoxPermute[25]=sBoxByte[12];pBoxPermute[26]=sBoxByte[29];pBoxPermute[27]=sBoxByte[5];pBoxPermute[28]=sBoxByte[21];pBoxPermute[29]=sBoxByte[10];pBoxPermute[30]=sBoxByte[3];pBoxPermute[31]=sBoxByte[24];return pBoxPermute}function finallyPermute(endByte){var fpByte=new Array(64);fpByte[0]=endByte[39];fpByte[1]=endByte[7];fpByte[2]=endByte[47];fpByte[3]=endByte[15];fpByte[4]=endByte[55];fpByte[5]=endByte[23];fpByte[6]=endByte[63];fpByte[7]=endByte[31];fpByte[8]=endByte[38];fpByte[9]=endByte[6];fpByte[10]=endByte[46];fpByte[11]=endByte[14];fpByte[12]=endByte[54];fpByte[13]=endByte[22];fpByte[14]=endByte[62];fpByte[15]=endByte[30];fpByte[16]=endByte[37];fpByte[17]=endByte[5];fpByte[18]=endByte[45];fpByte[19]=endByte[13];fpByte[20]=endByte[53];fpByte[21]=endByte[21];fpByte[22]=endByte[61];fpByte[23]=endByte[29];fpByte[24]=endByte[36];fpByte[25]=endByte[4];fpByte[26]=endByte[44];fpByte[27]=endByte[12];fpByte[28]=endByte[52];fpByte[29]=endByte[20];fpByte[30]=endByte[60];fpByte[31]=endByte[28];fpByte[32]=endByte[35];fpByte[33]=endByte[3];fpByte[34]=endByte[43];fpByte[35]=endByte[11];fpByte[36]=endByte[51];fpByte[37]=endByte[19];fpByte[38]=endByte[59];fpByte[39]=endByte[27];fpByte[40]=endByte[34];fpByte[41]=endByte[2];fpByte[42]=endByte[42];fpByte[43]=endByte[10];fpByte[44]=endByte[50];fpByte[45]=endByte[18];fpByte[46]=endByte[58];fpByte[47]=endByte[26];fpByte[48]=endByte[33];fpByte[49]=endByte[1];fpByte[50]=endByte[41];fpByte[51]=endByte[9];fpByte[52]=endByte[49];fpByte[53]=endByte[17];fpByte[54]=endByte[57];fpByte[55]=endByte[25];fpByte[56]=endByte[32];fpByte[57]=endByte[0];fpByte[58]=endByte[40];fpByte[59]=endByte[8];fpByte[60]=endByte[48];fpByte[61]=endByte[16];fpByte[62]=endByte[56];fpByte[63]=endByte[24];return fpByte}function getBoxBinary(i){var binary="";switch(i){case 0:binary="0000";break;case 1:binary="0001";break;case 2:binary="0010";break;case 3:binary="0011";break;case 4:binary="0100";break;case 5:binary="0101";break;case 6:binary="0110";break;case 7:binary="0111";break;case 8:binary="1000";break;case 9:binary="1001";break;case 10:binary="1010";break;case 11:binary="1011";break;case 12:binary="1100";break;case 13:binary="1101";break;case 14:binary="1110";break;case 15:binary="1111";break}return binary}function generateKeys(keyByte){var key=new Array(56);var keys=new Array();keys[0]=new Array();keys[1]=new Array();keys[2]=new Array();keys[3]=new Array();keys[4]=new Array();keys[5]=new Array();keys[6]=new Array();keys[7]=new Array();keys[8]=new Array();keys[9]=new Array();keys[10]=new Array();keys[11]=new Array();keys[12]=new Array();keys[13]=new Array();keys[14]=new Array();keys[15]=new Array();var loop=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];for(i=0;i<7;i++){for(j=0,k=7;j<8;j++,k--){key[i*8+j]=keyByte[8*k+i]}}var i=0;for(i=0;i<16;i++){var tempLeft=0;var tempRight=0;for(j=0;j<loop[i];j++){tempLeft=key[0];tempRight=key[28];for(k=0;k<27;k++){key[k]=key[k+1];key[28+k]=key[29+k]}key[27]=tempLeft;key[55]=tempRight}var tempKey=new Array(48);tempKey[0]=key[13];tempKey[1]=key[16];tempKey[2]=key[10];tempKey[3]=key[23];tempKey[4]=key[0];tempKey[5]=key[4];tempKey[6]=key[2];tempKey[7]=key[27];tempKey[8]=key[14];tempKey[9]=key[5];tempKey[10]=key[20];tempKey[11]=key[9];tempKey[12]=key[22];tempKey[13]=key[18];tempKey[14]=key[11];tempKey[15]=key[3];tempKey[16]=key[25];tempKey[17]=key[7];tempKey[18]=key[15];tempKey[19]=key[6];tempKey[20]=key[26];tempKey[21]=key[19];tempKey[22]=key[12];tempKey[23]=key[1];tempKey[24]=key[40];tempKey[25]=key[51];tempKey[26]=key[30];tempKey[27]=key[36];tempKey[28]=key[46];tempKey[29]=key[54];tempKey[30]=key[29];tempKey[31]=key[39];tempKey[32]=key[50];tempKey[33]=key[44];tempKey[34]=key[32];tempKey[35]=key[47];tempKey[36]=key[43];tempKey[37]=key[48];tempKey[38]=key[38];tempKey[39]=key[55];tempKey[40]=key[33];tempKey[41]=key[52];tempKey[42]=key[45];tempKey[43]=key[41];tempKey[44]=key[49];tempKey[45]=key[35];tempKey[46]=key[28];tempKey[47]=key[31];switch(i){case 0:for(m=0;m<48;m++){keys[0][m]=tempKey[m]}break;case 1:for(m=0;m<48;m++){keys[1][m]=tempKey[m]}break;case 2:for(m=0;m<48;m++){keys[2][m]=tempKey[m]}break;case 3:for(m=0;m<48;m++){keys[3][m]=tempKey[m]}break;case 4:for(m=0;m<48;m++){keys[4][m]=tempKey[m]}break;case 5:for(m=0;m<48;m++){keys[5][m]=tempKey[m]}break;case 6:for(m=0;m<48;m++){keys[6][m]=tempKey[m]}break;case 7:for(m=0;m<48;m++){keys[7][m]=tempKey[m]}break;case 8:for(m=0;m<48;m++){keys[8][m]=tempKey[m]}break;case 9:for(m=0;m<48;m++){keys[9][m]=tempKey[m]}break;case 10:for(m=0;m<48;m++){keys[10][m]=tempKey[m]}break;case 11:for(m=0;m<48;m++){keys[11][m]=tempKey[m]}break;case 12:for(m=0;m<48;m++){keys[12][m]=tempKey[m]}break;case 13:for(m=0;m<48;m++){keys[13][m]=tempKey[m]}break;case 14:for(m=0;m<48;m++){keys[14][m]=tempKey[m]}break;case 15:for(m=0;m<48;m++){keys[15][m]=tempKey[m]}break}}return keys};